/* ==========================================================
   1. 기본 설정 (Reset & Variables)
   ========================================================== */
* { 
    box-sizing: border-box; 
    user-select: none; 
    -webkit-tap-highlight-color: transparent; 
}

:root {
    /* Main Colors */
    --primary-blue: #1e7df0;
    --sky-blue: #00b0ff;
    --text-dark: #333;
    --text-gray: #666;
    --bg-gray: #f2f2f2;
    
    /* Pastel Colors */
    --b-green: #a5d6a7; --b-yellow: #fff59d; --b-orange: #ffcc80;
    --b-blue: #90caf9; --b-purple: #ce93d8; --b-teal: #80cbc4;
    --b-brown: #bcaaa4; --b-lime: #e6ee9c; --b-sky: #81d4fa; --b-gold: #ffe082;
}

body { 
    margin: 0; padding: 0; 
    font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; 
    background-color: var(--bg-gray); 
    height: 100vh; 
    overflow: hidden; 
    display: flex; justify-content: center; align-items: center; 
}

/* 스크롤바 숨김 (공통) */
.text-container::-webkit-scrollbar,
.passage-preview::-webkit-scrollbar,
.question-box::-webkit-scrollbar { display: none; }
.text-container, .passage-preview, .question-box {
    -ms-overflow-style: none; /* IE, Edge */
    scrollbar-width: none;    /* Firefox */
}

/* ==========================================================
   2. 레이아웃 (Layout: App Container, Header, Nav)
   ========================================================== */
#app-container {
    width: 1200px; height: 800px; 
    background: white; border-radius: 12px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
    display: flex; flex-direction: column; 
    overflow: hidden; position: relative; 
}

/* 헤더 */
header {
    height: 60px; border-bottom: 3px solid #3b82f6; 
    display: flex; align-items: center; padding: 0 30px; 
    justify-content: space-between; background: white; 
    z-index: 10; flex-shrink: 0; 
    display: none; /* 인트로/아웃트로에선 JS로 제어됨 */
}
.logo { font-size: 24px; font-weight: bold; color: #374151; }
.logo span { color: #2563eb; }

.close-app-btn {
    cursor: pointer; color: #9ca3af;
    display: flex; align-items: center; justify-content: center;
    width: 40px; height: 40px; border-radius: 50%;
    transition: all 0.2s; margin-left: 15px;
}
.close-app-btn:hover { background-color: #f3f4f6; color: #ef4444; transform: scale(1.1); }

/* 상단 탭 */
.tabs {
    display: none; background-color: #f3f4f6; 
    padding: 10px 30px 0; border-bottom: 1px solid #e5e7eb; 
    gap: 5px; flex-shrink: 0; 
}
.tab-btn {
    padding: 12px 25px; border-radius: 12px 12px 0 0; border: none; 
    cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; 
    opacity: 0.7; transition: all 0.2s; transform: translateY(5px); 
    font-size: 16px; background-color: #e5e7eb; color: #9ca3af;
}
.tab-btn.active { opacity: 1; transform: translateY(0); box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
.tab-btn.tab-vocab.active { background-color: #9333ea; color: white; }
.tab-btn.tab-read.active { background-color: #3b82f6; color: white; }
.tab-btn.tab-structure.active { background-color: #60A5FA; color: white; }
.tab-btn.tab-write.active { background-color: #c026d3; color: white; }

/* 하단 네비게이션 컨테이너 (화면 양 끝으로 넓힘) */
.nav-controls {
    position: absolute; 
    bottom: 30px; 
    left: 0; 
    right: 0; 
    width: 100%; 
    padding: 0; 
    display: flex; 
    justify-content: space-between; 
    pointer-events: none; 
    z-index: 1000 !important;
}

/* 하단 네비게이션 버튼 (이미지 적용 & 크기 확대) */
.nav-btn {
    width: 160px;   /* 크게 확대 */
    height: 80px;   /* 크게 확대 */
    
    background-color: transparent; 
    border: none; 
    box-shadow: none; 
    cursor: pointer; 
    pointer-events: auto; 
    
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    
    transition: transform 0.2s, opacity 0.2s; 
}

/* 마우스 올렸을 때 살짝 커짐 */
.nav-btn:not(:disabled):hover { 
    transform: scale(1.05); 
}

/* =========================================
   1. 이전 버튼 (이미지 1개로 운용)
   ========================================= */
#prev-btn {
    background-image: url('imgs/btn_prev.png'); margin-left: -41px; 
}

/* 이전 버튼 비활성 상태: 투명도 조절 */
#prev-btn:disabled {
    opacity: 0.3;     
    cursor: default;  
    transform: none;  
}

/* =========================================
   2. 다음 버튼 (이미지 2개로 운용)
   ========================================= */
/* 활성 상태 (Enabled) */
#next-btn {
    background-image: url('imgs/btn_next_o.png'); margin-right: -41px;
}

/* 비활성 상태 (Disabled) */
#next-btn:disabled {
    background-image: url('imgs/btn_next.png'); margin-right: -41px;
    cursor: default;
    transform: none;
    opacity: 1; 
}

.dots-indicator {
    background: transparent; padding: 10px 25px; border-radius: 30px; 
    display: flex; gap: 12px; border: none; pointer-events: auto; 
    align-items: center; position: relative; top: 20px; 
}
.dot { width: 14px; height: 14px; border-radius: 50%; background-color: #d1d5db; transition: background-color 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.dot.active { background-color: #ef4444; }

/* 공통 화면 설정 */
.content-area {
    flex-grow: 1; position: relative; overflow: hidden; 
    background-color: transparent; display: flex; flex-direction: column; 
}
.screen {
    display: flex; width: 100%; height: 100%; position: relative; 
    animation: fadeIn 0.3s ease-out; flex-direction: column; padding-bottom: 0 !important;
}
.center-wrapper {
    width: 100%; max-width: 1200px; margin: 0 auto; flex-grow: 1; 
    display: flex; flex-direction: column; position: relative; padding-bottom: 100px; 
}

/* UI 표시 제어 */
body:not(.is-intro):not(.is-outro) header,
body:not(.is-intro):not(.is-outro) .tabs,
body:not(.is-intro):not(.is-outro) .nav-controls {
    display: flex !important;
}

/* 공통 배너 */
.instruction-banner {
    color: white; padding: 15px 30px; margin: 20px 30px 10px; 
    border-radius: 15px; display: flex; align-items: center; gap: 12px; 
    box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-size: 20px; 
    flex-shrink: 0; font-weight: bold; position: relative; z-index: 10;
}
/* 배너 색상 */
#vocab-screen .instruction-banner { background-color: #9333ea; box-shadow: 0 4px 0 #7e22ce; }
#read-screen .instruction-banner { background-color: #3b82f6; box-shadow: 0 4px 0 #2563eb; }
.structure-layout .instruction-banner, #structure-screen .instruction-banner { background-color: #60A5FA; box-shadow: 0 4px 0 #4d9bfa; }
#write-screen .instruction-banner { background-color: #c026d3; box-shadow: 0 4px 0 #a21caf; }


/* ==========================================================
   3. 인트로 & 아웃트로 (3D 책)
   ========================================================== */
.intro-bg {
    background-image: url('imgs/intro_back.jpg'); background-size: cover; background-position: center; 
    display: flex; flex-direction: column; justify-content: center; align-items: center; 
    position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: visible;
}
.outro-bg { 
    background-image: url('imgs/intro_back.jpg'); background-size: cover; background-position: center;
    justify-content: flex-start; align-items: center; padding-top: 50px; 
    position: absolute; top: 0; left: 0; height: 100%; width: 100%;
}

.book-stage, .intro-book-stage, .outro-book-stage {
    width: 1000px; height: 600px; display: flex; justify-content: center; align-items: center;
    perspective: 2000px; position: relative;
    transform: scale(0.9); margin-top: -30px;
}
.outro-book-stage { width: 900px; height: 550px; margin-top: 100px; }

.book-container, .intro-book-container, .outro-book-container {
    width: 450px; height: 550px; position: relative; transform-style: preserve-3d;
}

/* 인트로 열리기 */
.book-container, .intro-book-container {
    animation: centerBook 1.8s cubic-bezier(0.25, 1, 0.5, 1) forwards; animation-delay: 1s;
}
@keyframes centerBook { 0% { transform: translateX(0); } 100% { transform: translateX(225px); } }

/* 아웃트로 닫히기 */
.outro-book-container {
    transform: translateX(225px); animation: recenterBookOutro 1.6s ease 1.0s forwards;
}
@keyframes recenterBookOutro { 0% { transform: translateX(225px); } 100% { transform: translateX(0); } }

.book-page, .right-page {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-color: white; border-radius: 0 20px 20px 0 !important;
    box-shadow: inset 5px 0 10px rgba(0,0,0,0.05);
}
.right-page { z-index: 1; box-shadow: 20px 20px 30px rgba(0,0,0,0.3); border-left: 1px solid #eee; }
.page-content { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; overflow: hidden; border-radius: 0 20px 20px 0; }
.intro-illust { width: 100%; height: 100%; object-fit: cover; }

.intro-flip-page, .outro-flip-page {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 10; transform-origin: left center; transform-style: preserve-3d;
}

.intro-flip-page { animation: openCover 1.8s cubic-bezier(0.25, 1, 0.5, 1) forwards; animation-delay: 1s; }
@keyframes openCover { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(-180deg); } }

.outro-flip-page { transform: rotateY(-180deg); animation: closeCover 1.6s cubic-bezier(0.25, 1, 0.5, 1) 1.0s forwards; }
@keyframes closeCover { 0% { transform: rotateY(-180deg); } 100% { transform: rotateY(0deg); } }

.page-face { position: absolute; top: 0; left: 0; width: 100%; height: 100%; backface-visibility: hidden; overflow: hidden; }

/* 표지 (앞면) */
.page-front {
    background-color: white; border: 3px solid #60a5fa;
    display: flex; justify-content: center; align-items: center; z-index: 2;
    border-radius: 0 20px 20px 0 !important;
}
.cover-spine {
    position: absolute; left: 0; top: 0; bottom: 0; width: 30px;
    background: linear-gradient(to right, #93c5fd, #bfdbfe); border-right: 2px solid #60a5fa; border-radius: 2px 0 0 2px;
}
.cover-title-box { text-align: center; }
.cover-main-title { font-size: 50px; font-weight: 900; color: #111; margin-bottom: 10px; letter-spacing: -2px; }
.cover-sub-title { font-size: 20px; color: #555; font-weight: bold; }

/* 인트로 뒷면 */
.page-back {
    background-color: transparent !important;
    background-image: linear-gradient(to bottom, #2B3A65 0%, #4C6491 60%, #8DA6C9 100%) !important;
    transform: rotateY(180deg);
    border-right: 1px solid #eee;
    border-radius: 20px 0 0 20px !important;
    
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    padding: 0 !important;
}
.page-back .page-content {
    display: flex !important;
    flex-direction: column !important; 
    justify-content: center !important;
    align-items: center !important;
    width: 100%;
    height: 100%;
    background: transparent !important;
    border: none !important;
}
.page-back::before {
    content: ''; position: absolute; top: 10%; left: 20%; width: 2px; height: 2px; background: white;
    box-shadow: 100px 50px 0 white, -50px 150px 0 white, 80px 250px 0 white, 30px 400px 1px white, 150px 300px 1px white;
    opacity: 0.6; animation: twinkle 3s infinite ease-in-out;
}
.page-back .intro-badge {
    background-color: #fcd34d !important;
    color: #1e3a8a !important;
    padding: 10px 30px;
    border-radius: 30px;
    font-size: 20px;
    font-weight: 800;
    margin-bottom: 30px !important; 
    margin-top: 0 !important;
    align-self: center !important;
    width: fit-content;
    box-shadow: 0 0 15px rgba(252, 211, 77, 0.4) !important;
    border: 2px solid #ffffff;
}
.page-back .intro-main-title {
    color: #ffffff !important;
    text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
    font-size: 45px;
    font-weight: 900;
    line-height: 1.3;
    text-align: center !important;
    margin: 0 !important;
    width: 100%;
}

.start-btn {
    position: absolute; bottom: -100px; z-index: 50; width: 300px; height: 90px; cursor: pointer; border: none; background-color: transparent;
    color: transparent; background-image: url('imgs/btn_start.png'); background-size: contain; background-repeat: no-repeat; background-position: center;
    opacity: 0; animation: fadeAppear 0.5s ease-out 2.2s forwards, pulse-btn 1.5s infinite ease-in-out 2.2s;
}
.start-btn:hover { animation-play-state: paused; transform: scale(1.1) !important; opacity: 1 !important; }

.outro-content-wrapper {
    position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    opacity: 0; animation: fadeAppear 0.5s ease-out 3.0s forwards;
}
.outro-btn-group { display: flex; gap: 20px; justify-content: center; margin-top: 10px; }
.replay-btn {
    font-family: 'Noto Sans KR', sans-serif; font-size: 20px; font-weight: 500; padding: 15px 40px; border-radius: 40px; border: none; cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: all 0.2s; display: flex; align-items: center; gap: 8px; color: white;
}
.replay-btn.exit-btn { background-color: #6b7280; box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3); }
.replay-btn.retry-btn { background-color: #f59e0b; box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3); }
.replay-btn:hover { transform: translateY(-2px) scale(1.05); }


/* ==========================================================
   4. 어휘랑 (Vocab)
   ========================================================== */
#vocab-screen { background-image: url('imgs/back6.png'); background-size: cover; background-position: center; }

/* 1단계: 카드 학습 */
.vocab-container { padding: 0 40px; flex-grow: 1; display: flex; align-items: center; justify-content: center; gap: 20px; }
.vocab-card { 
    background: #fce7f3; border: 5px solid #f45d8b; border-radius: 40px; padding: 20px 40px; width: 100%; max-width: 900px; 
    box-shadow: 0 20px 40px rgba(0,0,0,0.08); display: flex; flex-direction: column; position: relative; margin: 40px 0 30px; 
}
.vocab-arrow-btn { background: #3b82f6; border: none; cursor: pointer; color: white; transition: transform 0.2s; padding: 15px; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
.vocab-arrow-btn:hover { transform: scale(1.1); }
.vocab-next-arrow, .vocab-prev-arrow { 
    position: absolute; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #1ca7a0; z-index: 20; padding: 0; transition: transform 0.2s;
}
.vocab-next-arrow svg, .vocab-prev-arrow svg { width: 70px; height: 70px; stroke-width: 4px; }
.vocab-next-arrow { right: -80px; }
.vocab-prev-arrow { left: -80px; }
.vocab-next-arrow:hover, .vocab-prev-arrow:hover { transform: translateY(-50%) scale(1.1); }

.header-star-wrapper { position: absolute; top: 5px; right: -90px; display: flex; gap: 8px; z-index: 10; }
.header-star-img { width: 35px; height: 35px; object-fit: contain; }

.vocab-main-title { text-align: center; font-size: 60px; font-weight: 900; color: #1f2937; margin-bottom: 5px; }
.hanja-box { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 15px; }
.hanja-item { display: flex; align-items: center; gap: 10px; font-size: 32px; color: #4b5563; }
.hanja-reveal { background-color: #1ca7a0; color: white; padding: 5px 20px; border-radius: 10px; cursor: pointer; transition: 0.3s; min-width: 80px; text-align: center; font-size: 20px; }
.hanja-reveal.revealed { background-color: #e1f7f7; border: 3px  solid #1ca7a0; color: #365c5a; font-weight: bold; }

.vocab-bottom-layout { display: flex; gap: 30px; border: 3px dashed #fda4af; border-radius: 20px; padding: 20px; background-color: #fff7ed; align-items: center; }
.vocab-img-placeholder { width: 240px; height: 180px; background: white; border-radius: 15px; border: 2px solid #fed7aa; display: flex; justify-content: center; align-items: center; overflow: hidden; flex-shrink: 0; }
.vocab-text-area { flex-grow: 1; display: flex; flex-direction: column; gap: 15px; }
.vocab-row { display: flex; align-items: center; gap: 20px; }
.vocab-label { background-color: #374151; color: white; padding: 8px 0; border-radius: 10px; font-weight: bold; font-size: 20px; width: 80px; text-align: center; flex-shrink: 0; }
.vocab-desc { font-size: 20px; color: #374151; font-weight: 500; display: flex; align-items: center; gap: 10px; white-space: nowrap; overflow: hidden; }
.highlight-word { color: #2563eb; font-weight: 900; }
.speaker-img-btn { width: 32px; height: 32px; cursor: pointer; vertical-align: middle; transition: transform 0.2s; margin: 4px 8px; }
.speaker-img-btn:hover { transform: scale(1.2); }


/* [수정 완료] 어휘랑 2단계 (게임) - 전체 화면 꽉 채우기 및 비율 고정 */

/* 1. 게임 화면 패딩 강제 제거 */
#vocab-step-1 { width: 100%; height: 100%; display: flex; flex-direction: column; }
#screen-vocab { padding: 0 !important; width: 100%; height: 100%; }

/* 2. 게임 레이아웃 (style1.css 기반) */
.game-layout {
    width: 100%; height: 100%;
    display: flex; flex-direction: column;
    background: url('imgs/scene_background.png') center bottom no-repeat; 
    background-size: cover; 
    position: relative; 
}
/* 전체 화면을 덮는 반투명 흰색 마스크 */
.game-layout::before {
    content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(255, 255, 255, 0.1); 
    z-index: 1; pointer-events: none;
}
/* 게임 상단 배너 */
.game-layout .instruction-banner {
    width: 90%; margin: 20px auto 10px auto; 
    flex-shrink: 0; z-index: 10; position: relative;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* 3. 게임 배경 (여백 없이 100% 채우기) */
.scene-container { 
    position: relative; flex: 1; width: 100%; margin: 0; 
    background: none; overflow: hidden; z-index: 5;
}

/* 4. 문제 텍스트 상자 */
#quiz-text-overlay { 
    position: absolute; top: 35px; left: 50%; transform: translateX(-50%); z-index: 20;
    background-color: rgba(255, 255, 255, 0.95); padding: 15px 50px; 
    border-radius: 50px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); 
    border: 3px solid #4dd0e1; width: 800px; 
    display: flex; align-items: center; justify-content: center;
}
.quiz-sentence { font-size: 32px; font-weight: 800; color: #333; margin: 0; display: flex; align-items: center; gap: 12px; white-space: nowrap; }
.blank-box { 
    display: inline-flex; justify-content: center; align-items: center; width: 120px; height: 50px; 
    border: 3px solid #333; border-radius: 12px; background: white; font-size: 30px; font-weight: bold; color: #333; transition: all 0.3s; 
}
.blank-box.correct { color: #fff; border-color: #00b894; background-color: #00b894; }

/* 5. 캐릭터 위치 (bottom 기준) */
#learner, #monster { 
    position: absolute; width: 280px; height: auto; bottom: 140px; z-index: 10; transition: all 0.5s; 
}
#learner { left: 5%; } 
#monster { right: 5%; }
#effect { position: absolute; width: 200px; height: auto; z-index: 20; opacity: 0; pointer-events: none; transform: translate(-50%, -50%); }

.char-default-size { animation: float-up-down 3s ease-in-out infinite; }
.char-attack-size { transform: scale(1.1); }
@keyframes float-up-down { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
@keyframes attack-to-monster { 0% { opacity: 1; left: 20%; top: 60%; } 100% { opacity: 0; left: 80%; top: 60%; } }
@keyframes attack-to-learner { 0% { opacity: 1; left: 80%; top: 60%; } 100% { opacity: 0; left: 20%; top: 60%; } }

/* 6. 게임 버튼 위치 (bottom 기준) */
#option-wrapper { 
    position: absolute; bottom: 70px; left: 50%; transform: translateX(-50%); 
    width: 90%; display: flex; justify-content: center; gap: 20px; z-index: 30; 
}
.option-item { 
    padding: 12px 10px; font-size: 27px; font-weight: bold; border-radius: 50px; border: 4px solid white; 
    display: flex; align-items: center; gap: 10px; cursor: pointer; box-shadow: 0 6px 12px rgba(0,0,0,0.15); 
    transition: all 0.2s; background: white; width: 220px; justify-content: center; margin: 0 20px;
}
.option-item:hover { transform: scale(1.05) translateY(-3px); border-color: #a000c8 }
.option-item.clicked { transform: scale(0.95); }
.option-item.correct-border { border-color: #00b894 !important; } 
.option-item.wrong-border { border-color: #ff5252 !important; } 

/* 7. 기타 UI */
#stamp-complete {
    position: absolute; bottom: 110px; right: 50px; width: 140px; transform: scale(1.5); opacity: 0; 
    transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none; z-index: 100; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
}
#finger-guide { position: absolute; bottom: 30px; left: 50%; width: 50px; opacity: 0; pointer-events: none; z-index: 55; }


/* ==========================================================
   5. 읽기랑 (Read)
   ========================================================== */
#read-screen { background-image: url('imgs/bg3.png'); background-size: cover; background-position: center; }

.reading-layout { padding: 0 40px; flex-grow: 1; display: flex; justify-content: center; align-items: center; }
.text-container {
    width: 100%; max-width: 1250px; height: 500px; border-radius: 30px; border: 5px solid #93c5fd; padding: 50px;
    line-height: 1.2; font-size: 20px; color: #374151; background-color: white; overflow-y: auto; position: relative;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
}
.passage-image-wrapper { 
    float: right; width: 350px; margin: -40px 0 20px 40px; shape-outside: circle(50%); display: block; 
}
.passage-image { 
    width: 100%; max-height: 250px; border-radius: 50%; object-fit: cover; 
    mask-image: radial-gradient(circle, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 70%); -webkit-mask-image: radial-gradient(circle, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 70%);
}
.read-done-btn { 
    width: 200px; height: 53px; margin: 50px auto 0; background-color: #2563eb; color: white; border: none; border-radius: 40px; 
    font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3); 
    clear: both; display: flex; justify-content: center; align-items: center;
}
.read-done-btn:hover { background-color: #1d4ed8; transform: translateY(-2px); }

.key-sentence-bubble { 
    display: none; position: relative; background-color: #fffbeb; border: 3px solid #fcd34d; border-radius: 50px; 
    padding: 30px; margin: 30px auto 0; width: 90%; max-width: 1000px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
    animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
}
.key-sentence-bubble::after { 
    content: ''; position: absolute; top: -15px; left: 50%; transform: translateX(-50%); 
    border-width: 0 15px 15px; border-style: solid; border-color: #fcd34d transparent; 
}
.key-icon-circle { background: #fbbf24; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
@keyframes popUp { from { opacity: 0; transform: translateY(-20px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }

/* 읽기 퀴즈 */
.quiz-container { width: 100%; max-width: 1100px; margin: 0 auto; display: flex; gap: 15px; height: 100%; max-height: 500px; min-height: 450px; }
.passage-preview { width: 40%; background: #f9fafb; padding: 30px; border-radius: 20px; overflow-y: auto; font-size: 16px; line-height: 1.8; color: #6b7280; border: 5px solid #bfdbfe; }
.question-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.question-box { background: white; padding: 40px; border-radius: 20px; border: 5px solid #bfdbfe; flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; }
.q-tag { background: #2563eb; color: white; padding: 8px 20px; border-radius: 20px; font-weight: bold; align-self: flex-start; margin-bottom: 20px; }
.q-text { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #1f2937; line-height: 1.4; }

/* [충돌 해결] 읽기랑 전용 선택지 스타일 (게임과 분리) */
#read-screen .option-list { display: flex; flex-direction: column; gap: 12px !important; width: 100% !important; margin: 0 !important; }
#read-screen .option-item {
    margin: 0 !important; width: 100% !important; font-size: 17px !important; justify-content: flex-start !important; 
    padding: 12px 20px !important; border: 2px solid #d1d5db !important; border-radius: 30px !important;
    background-color: white; color: #374151; transform: none !important;
}
#read-screen .option-item:hover { background-color: #f3f4f6; border-color: #9ca3af !important; }
#read-screen .option-item.selected { border-color: #2563eb !important; background: #eff6ff; color: #1e40af; font-weight: bold; }
#read-screen .option-item.correct { border-color: #16a34a !important; background: #dcfce7; color: #166534; }
#read-screen .option-item.wrong { border-color: #ef4444 !important; background: #fee2e2; color: #991b1b; animation: shake 0.5s ease-in-out; }

.explanation-box { background: #eff6ff; padding: 25px; border-radius: 15px; margin-top: 30px; border: 2px solid #bfdbfe; display: none; line-height: 1.6; }
.explanation-box.show { display: block; animation: fadeIn 0.3s; }

#read-quiz-finger {
    position: absolute; width: 60px; height: auto; z-index: 9999; display: none; pointer-events: none; 
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); animation: quiz-finger-bounce 1s infinite ease-in-out;
}
@keyframes quiz-finger-bounce { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(10px, -10px); } }


/* ==========================================================
   6. 구조랑 (Structure) - 통합 수정본
   ========================================================== */
.structure-layout { padding: 0 40px 120px; height: calc(100% - 100px); display: flex; flex-direction: column; gap: 30px; }

/* 배경 및 인트로 카드 */
.structure-intro-bg { 
    background-image: url('imgs/back5.png'); background-size: cover; background-position: center; 
    padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; position: relative;
}
.structure-title-banner { background: #ffffff; border: 3px solid #81cc64; color: #black; padding: 5px 15px; border-radius: 30px; font-size: 14px; font-weight: bold; position: absolute; top: 20px; left: 20px; margin-bottom: 60px; }
.structure-card { 
    background: white; border: 5px solid #81cc64; border-radius: 40px; padding: 50px 80px; 
    position: relative; max-width: 800px; width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
}
.structure-card-header { 
    position: absolute; top: -25px; left: 50%; transform: translateX(-50%); 
    background: #81cc64; color: #ffffff; padding: 10px 30px; border-radius: 25px; font-weight: bold; font-size: 20px; 
    display: flex; align-items: center; gap: 10px; 
}
.structure-main-title { font-size: 48px; font-weight: 900; color: #374151; margin: 30px 0 40px; text-align: center; }
.structure-list { display: flex; flex-direction: column; gap: 20px; }
.structure-item { display: flex; align-items: center; gap: 15px; font-size: 22px; color: #374151; }
.structure-badge { background: #f59e0b; color: white; padding: 5px 15px; border-radius: 15px; font-size: 16px; font-weight: bold; }
.structure-start-btn { 
    margin-top: 50px; background: #34a853; color: white; padding: 15px 40px; border-radius: 30px; font-size: 24px; font-weight: bold; border: none; 
    cursor: pointer; box-shadow: 0 10px 20px rgba(43, 140, 69, 0.3); transition: transform 0.2s; 
}
.structure-start-btn:hover { transform: scale(1.05); }

/* 공통 공식 박스 */
.formula-box { margin: 5px 40px 10px; display: flex; align-items: center; gap: 10px; font-size: 18px; color: #374151; font-weight: bold; }
.formula-tag { background: #374151; color: #facc15; padding: 5px 15px; border-radius: 20px; display: flex; align-items: center; gap: 5px; }
.formula-sub-tag { background: #f97316; color: white; padding: 2px 10px; border-radius: 10px; font-size: 14px; }


/* 구조랑 1, 2, 3단계 공통 배경 설정 */
#structure-step-1, 
#structure-step-2, 
#structure-step-3 {
    background-image: url('imgs/back.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

/* ----------------------------------------------------------
   Step 1: 개념 학습 (요청사항 반영)
   ---------------------------------------------------------- */
.concept-container { padding: 0 40px 100px; display: flex; flex-direction: column; gap: 20px; height: 100%; overflow: hidden; }

.definition-row { display: flex; gap: 20px; height: 100px; }
.def-label, .ex-label-vertical { 
    background: #fffceb; border: 3px solid #fcd452; width: 140px; border-radius: 15px; display: flex; justify-content: center; align-items: center; 
    font-size: 24px; font-weight: 800; color: black; flex-shrink: 0; 
}

/* 1. 상징(정의) 박스: 클릭 후(흰색 배경+노란테두리)가 기본 베이스 */
.def-content { 
    flex: 1; 
    background: white;          /* 클릭 후: 흰색 배경 */
    border: 3px solid #fcd452;  /* 클릭 후: 노란 테두리 */
    border-radius: 15px; 
    display: flex; 
    align-items: center; 
    padding: 0 30px; 
    cursor: pointer; 
    position: relative; 
    overflow: hidden; 
    color: black;               /* 클릭 후: 검은 글자 */
}

/* 상징 정답 텍스트 */
.def-text { 
    display: none; 
    width: 100%; 
    font-size: 20px; 
    line-height: 1.5; 
    font-weight: bold; 
}

/* 2. 상징 물음표(커버): 클릭 전(노란 배경+흰색 물음표) */
.def-placeholder { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
    background: #fcd452; border: 3px solid #faca2f;      /* 클릭 전: 노란 배경 */
    color: white;               /* 클릭 전: 흰색 물음표 */
    font-size: 40px;            /* 물음표 크기 통일 */
    font-weight: 900; 
    display: flex; justify-content: center; align-items: center; 
    z-index: 10; 
}

.example-section { display: flex; gap: 20px; flex: 1; min-height: 250px; margin-bottom: 20px; }
.ex-cards-grid { flex: 1; display: flex; gap: 20px; }
.ex-item { flex: 1; display: flex; flex-direction: column; gap: 10px; }

.ex-img-box { 
    flex: 1; background: #dcebf9; border-radius: 15px; overflow: hidden; 
    border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; 
}
.ex-img-box img { width: 100%; height: 100%; object-fit: contain; }

/* 3. 예시 정답 박스: 클릭 전 */
.ex-answer-box { 
    height: 70px; 
    background: #fcd452;        /* 클릭 전: 노란 배경 */
    border: 3px solid #faca2f;  /* 테두리 색상 통일 */
    border-radius: 15px; 
    display: flex; justify-content: center; align-items: center; 
    cursor: pointer; 
    font-size: 40px;            /* 물음표 크기 통일 (위와 같음) */
    font-weight: 900; 
    color: white;               /* 클릭 전: 흰색 물음표 */
    padding: 5px; 
    text-align: center; 
}

/* 4. 예시 정답 박스: 클릭 후 (revealed 클래스 추가됨) */
.ex-answer-box.revealed { 
    background: white;          /* 클릭 후: 흰색 배경 */
    border-color: #fcd452;      /* 클릭 후: 노란 테두리 */
    color: black;               /* 클릭 후: 검은 글자 */
    font-size: 18px;            /* 글자 크기 조정 (내용에 맞게) */
    font-weight: bold;
}

/* ----------------------------------------------------------
   Step 2: 비교하기
   ---------------------------------------------------------- */
.compare-grid-container {
    /* 1. 레이아웃 (Layout) */
    display: flex;
    flex-direction: column;
    flex: 0;                /* 화면의 남은 높이를 꽉 채움 */
    height: fit-content;           /* 높이는 내용물에 맞춰 유동적으로 */
    overflow: visible;      /* 드롭다운 메뉴가 잘리지 않게 함 */

    /* 2. 간격 (Spacing) */
    margin: 10px 40px 10px; /* 바깥 여백: 위 3px, 좌우 40px, 아래 3px */
    padding: 30px 20px;     /* 안쪽 여백: 흰색 박스와 글자 사이 간격 */

    /* 3. 디자인 (Visuals) */
    background: white;           /* 배경색: 흰색 */
    border-radius: 30px;         /* 모서리 둥글게 */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* 그림자: 입체감 추가 */
}
.compare-header-row { display: flex; margin-bottom: 0px; margin-top: 10px; flex-shrink: 0; }
.ch-empty { width: 140px; }
.ch-char { flex: 1; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 24px; font-weight: 900; }
.char-face { width: 60px; height: 60px; border-radius: 50%; background: #ddd; overflow: hidden; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.char-face img { width: 100%; height: 100%; object-fit: cover; }

.compare-table-wrapper { flex: 1; display: flex; flex-direction: column; gap: 8px; justify-content: flex-start; padding-top: 5px; }
.cp-row { display: flex; flex: 1; min-height: 70px; max-height: 70px; position: relative; z-index: 1; }
.cp-row:has(.cp-dropdown-list.show) { z-index: 3000; }
.cp-label { width: 140px; background: #e5e7eb; border-radius: 10px; margin-right: 5px; display: flex; justify-content: center; align-items: center; font-size: 18px; font-weight: 800; color: #374151; }
.cp-content { 
    flex: 1; background: #fff7ed; border-radius: 10px; margin-right: 5px; 
    display: flex; justify-content: center; align-items: center; font-size: 17px; font-weight: 600; text-align: center; border: 2px solid transparent; position: relative; 
}
.cp-content.yellow { background: #fef9c3; margin-right: 0; }
.cp-content.correct { background: #dcfce7; border-color: #22c55e; color: #15803d; }
.cp-dropdown-btn { width: 100%; height: 100%; border: none; background: transparent; cursor: pointer; font-size: 24px; font-weight: bold; color: #9ca3af; }
.cp-dropdown-list {
    position: absolute; top: 100%; left: 0; width: 100%; background: white; 
    border: 2px solid #3b82f6; border-radius: 8px; z-index: 50; display: none; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.2); max-height: 120px; overflow-y: auto; 
}
.cp-dropdown-list.show { display: block; }
.cp-option { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 14px; color: #333; text-align: left; }
.cp-option:hover { background: #eff6ff; }


/* ----------------------------------------------------------
   Step 3: 문장 찾기 (누락되었던 디자인 복구)
   ---------------------------------------------------------- */
.text-selection-area { padding: 0 40px 20px; display: flex; flex-direction: column; height: 100%; }

/* 상단 주황색 타겟 배너 */
.target-banner { 
    background: #ffedd5; border: 2px solid #fb923c; border-radius: 30px; 
    padding: 10px 30px; align-self: center; margin-bottom: 20px; 
    display: flex; gap: 20px; align-items: center; 
}
.target-text { font-size: 20px; font-weight: 900; color: #9a3412; }
.target-badge { background: #8b5cf6; color: white; padding: 4px 12px; border-radius: 15px; font-size: 14px; font-weight: bold; }

/* 지문 박스 */
.passage-box { 
    background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 15px; 
    padding: 30px; font-size: 20px; line-height: 2.2; color: #374151; 
    overflow-y: auto; height: 450px; margin-bottom: 40px; 
}

/* 문장 줄 (체크박스 포함) */
.sentence-wrapper { 
    display: flex; align-items: flex-start; gap: 15px; padding: 12px 15px; 
    margin-bottom: 10px; border-radius: 12px; cursor: pointer; 
    transition: all 0.2s; line-height: 1.6; border: 2px solid transparent; 
}
.sentence-wrapper:hover { background-color: #f3f4f6; }

/* 체크박스 동그라미 */
.check-box { 
    width: 27px; height: 27px; border: 2px solid #d1d5db; border-radius: 50%; 
    background: white; flex-shrink: 0; display: flex; justify-content: center; align-items: center; 
    font-size: 16px; font-weight: bold; margin-top: 4px; transition: all 0.2s; 
}
.sentence-text { flex: 1; font-size: 20px; color: #374151; font-weight: 500; }

/* 정답/오답 스타일 */
.sentence-wrapper.correct { background-color: #dcfce7; border-color: #22c55e; }
.sentence-wrapper.correct .check-box { background-color: #16a34a; border-color: #16a34a; color: white; }
.sentence-wrapper.correct .check-box::after { content: "✔"; }
.sentence-wrapper.correct .sentence-text { color: #14532d; font-weight: bold; }

.sentence-wrapper.wrong { background-color: #fee2e2; border-color: #ef4444; animation: shake 0.4s ease-in-out; }
.sentence-wrapper.wrong .check-box { background-color: #ef4444; border-color: #ef4444; color: white; }
.sentence-wrapper.wrong .check-box::after { content: "✕"; }

/* ==========================================================
   7. 쓰기랑 (Write)
   ========================================================== */
#write-screen { background-image: url('imgs/bg2.png'); background-size: cover; background-position: center; }

.writing-container { padding: 0 40px; height: 100%; display: flex; flex-direction: column; justify-content: center; }
.writing-layout-box { display: flex; align-items: flex-start; justify-content: center; gap: 20px; width: 100%; }
.writing-card { 
    background: white; border: 5px solid #F29AAE; border-radius: 30px; padding: 40px; width: 1050px; height: 450px; 
    box-shadow: 0 20px 40px rgba(0,0,0,0.08); display: flex; flex-direction: column; position: relative; flex-shrink: 0; 
}
.writing-side-buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 10px; }
.circle-btn { 
    width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; 
    color: white; font-weight: bold; font-size: 14px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; 
}
.circle-btn:hover { transform: scale(1.1); }
.circle-btn.orange { background-color: #FFFFFF; border: 2px solid #C47BE4; }
.circle-btn.green { background-color: #FFFFFF; border: 2px solid #7132CA; }
.circle-btn img { width: 40px; height: 40px; object-fit: contain; pointer-events: none; }
.writing-input { 
    flex-grow: 1; border: none; font-size: 24px; line-height: 1.8; color: #374151; outline: none; resize: none; 
    font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; 
}
.writing-input::placeholder { color: #d1d5db; }

/* 완료 버튼 */
.done-btn-container { display: flex; justify-content: center; width: 100%; margin-top: 20px; margin-bottom: 50px; pointer-events: auto; }
#vocab-done-container { position: absolute; top: 100%; margin-top: -20px; transform: translateX(300px); }
.writing-done-btn { 
    background-color: transparent; border: none; width: 210px; height: 60px; 
    background-image: url('imgs/btn_active.png'); background-size: contain; background-repeat: no-repeat; background-position: center; 
    cursor: pointer; transition: transform 0.2s; color: transparent; 
}
.writing-done-btn:disabled { background-image: url('imgs/btn_disabled.png'); cursor: not-allowed; }
.writing-done-btn:not(:disabled):hover { transform: scale(1.05); }

/* 모달 */
.modal-overlay { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); 
    z-index: 100; display: none; justify-content: center; align-items: center; 
}
.modal-overlay.active { display: flex; }
.modal-box { 
    background: white; width: 700px; max-height: 80%; padding: 40px; border-radius: 25px; 
    overflow-y: auto; position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.25); 
}
.close-modal { position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 30px; cursor: pointer; color: #9ca3af; }


/* ==========================================================
   8. 애니메이션 (Animations)
   ========================================================== */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes fadeAppear { from { opacity: 0; } to { opacity: 1; } }
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-5px); } 40% { transform: translateX(5px); }
    60% { transform: translateX(-5px); } 80% { transform: translateX(5px); }
}
@keyframes pulse-btn {
    0% { transform: scale(1); }
    50% { transform: scale(1.08); } 
    100% { transform: scale(1); }
}
@keyframes finger-pulse {
    0% { transform: scale(0.8); } 50% { transform: scale(1.1); } 100% { transform: scale(0.8); }
}
/* ==========================================================
   [필수 추가] 도장 등장 애니메이션
   ========================================================== */
#stamp-complete.show {
    opacity: 1 !important;          /* 투명도를 1로 변경 (보이게 함) */
    transform: scale(1) !important; /* 크기를 원래대로 */
    animation: stamp-bounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    z-index: 9999 !important;       /* 다른 그림들보다 무조건 위에 뜨게 함 */
    display: block !important;
}

@keyframes stamp-bounce {
    0% { opacity: 0; transform: scale(2); }
    100% { opacity: 1; transform: scale(1); }
}
/* [기능 추가] UI 잠금 (음원 재생 중 클릭 방지) */
.content-area.ui-locked {
    pointer-events: none !important; /* 클릭, 드래그 등 모든 동작 차단 */
    cursor: default;
}

.nav-controls { pointer-events: auto !important; }

/* ==========================================================
   [수정] UI 잠금 예외 처리 (이 부분을 style.css 맨 아래에 추가하세요)
   ========================================================== */

/* 1. 기본 잠금 설정 (기존에 추가하셨다면 유지, 없으면 추가) */
.content-area.ui-locked {
    pointer-events: none !important; 
    cursor: default;
}

/* 2. [중요] 잠금 상태에서도 눌려야 하는 요소들 (예외 처리) */
.content-area.ui-locked .writing-input,      /* 쓰기랑: 글자 입력창 */
.content-area.ui-locked .read-done-btn,      /* 읽기랑: 다 읽었어요 버튼 */
.content-area.ui-locked .writing-done-btn,   /* 쓰기랑: 다 했어요 버튼 */
.content-area.ui-locked .vocab-arrow-btn,    /* 어휘랑: 카드 넘기기 화살표 */
.content-area.ui-locked .speaker-img-btn,    /* 본문 듣기 스피커 */
.content-area.ui-locked .circle-btn,         /* 힌트/전체보기 버튼 */
.content-area.ui-locked .nav-btn,            /* 하단 이전/다음 버튼 */
.content-area.ui-locked .close-modal,        /* 팝업 닫기 버튼 */
.content-area.ui-locked .modal-overlay {     /* 팝업 배경 */
    pointer-events: auto !important;
}


/* style.css 맨 아래 수정 */

/* [기능 추가] UI 잠금 (음원 재생 중 클릭 방지) */
.content-area.ui-locked {
    pointer-events: none !important;
    cursor: default;
}

/* 네비게이션 컨트롤은 잠기지 않음 */
.nav-controls { pointer-events: auto !important; }

/* [중요] 완료 버튼과 입력창을 네비게이션보다 위로 올리고(z-index), 클릭 허용(pointer-events) */
.content-area.ui-locked .writing-input,
.content-area.ui-locked .read-done-btn,
.content-area.ui-locked .writing-done-btn,
.content-area.ui-locked .vocab-arrow-btn,
.content-area.ui-locked .speaker-img-btn,
.content-area.ui-locked .circle-btn,
.content-area.ui-locked .nav-btn,
.content-area.ui-locked .close-modal,
.content-area.ui-locked .modal-overlay,
/* [추가] 잠금 상태가 아닐 때도 버튼이 네비게이션 위로 올라오도록 설정 */
.read-done-btn, 
.writing-done-btn,
.done-btn-container {
    pointer-events: auto !important;
    position: relative;
    z-index: 2000 !important; /* 네비게이션(1000)보다 무조건 위 */
}
